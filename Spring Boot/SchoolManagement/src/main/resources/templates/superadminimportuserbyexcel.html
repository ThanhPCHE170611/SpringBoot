<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel File Uploader</title>
  <!-- Add Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<STYLE>
  body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  }
  #navbar-container {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
  }
  #upload-form {
  margin-top: 70px;
  margin-bottom: 20px;
  border: 2px dashed #ccc;
  padding: 20px;
  height: 200px;
  text-align: center;
  }
  #error-history {
  margin: 0 auto; /* Center the history table horizontally */
  }
  #error-history-table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
  }
  #error-history-table th, #error-history-table td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
  }
  #error-history-table th {
  background-color: #f2f2f2;
  }
  </style>
</head>
<body>
<!-- Navigation Bar -->
<div id="navbar-container">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/superadmin/homepage">Super Admin Home</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="/superadmin/homepage">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/superadmin/usermanagement">User Management</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/superadmin/subjectmanagement">Subject Management</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/superadmin/semestermanagement">Semester Management</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/superadmin/Organizationmanagement">Organization Management</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/superadmin/reportmanagement">Report Management</a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown"> <!-- Added dropdown class here -->
          <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button" data-toggle="dropdown"
             aria-haspopup="true" aria-expanded="false">
            Super Admin Account
          </a>
          <div class="dropdown-menu" aria-labelledby="accountDropdown">
            <a class="dropdown-item" href="/logout">Logout</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>
</div>

<div class="container d-flex justify-content-center align-items-center">
  <div class="row">
    <div class="col-md-12" id="upload-form" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)">
      <h2>Drag and drop your Excel file here to upload!</h2>
      <p>File must be in .xls or .xlsx format</p>
      <button class="btn btn-primary"><a href="/schooladmin/exceldownload/generateusertemplate" style="color:black;text-decoration: none;">Download Template</a></button>
    </div>

    <div class="col-md-12" id="error-history">
      <h2>Error History</h2>
      <table class="table" id="error-history-table">
        <thead>
        <tr>
          <th>Date</th>
          <th>Status</th>
          <th>Error Message</th>
        </tr>
        </thead>
        <tbody id="error-history-body">
        <tr th:each="field : ${historyList}">
          <td th:text="${field.getDate()}" ></td>
          <td th:text="${field.getStatus()}" ></td>
          <td th:text="${field.getError()}" ></td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add Bootstrap JS and Popper.js (required for Bootstrap JS) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function dragOverHandler(event) {
    event.preventDefault();
    event.dataTransfer.dropEffect = 'copy';
  }

  function dropHandler(event) {
    event.preventDefault();
    var files = event.dataTransfer.files;

    if (files.length > 0) {
      var file = files[0];
      if (isExcelFile(file)) {
        uploadFile(file);
      } else {
        alert('Invalid file format. Please upload a .xls or .xlsx file.');
      }
    }
  }

  function isExcelFile(file) {
    // Check if the file has a valid Excel format
    return file.name.endsWith('.xls') || file.name.endsWith('.xlsx');
  }

  function uploadFile(file) {
    // You can use AJAX or fetch API to send the file to the server
    // The server will process the file and return the error history
    // For simplicity, this example only simulates a server response

    // Simulate server response
    var serverResponse = {
      success: true,
      errorHistory: [
        { date: '2023-11-09', message: 'Duplicate entry in row 5.' },
        { date: '2023-11-08', message: 'Invalid format in row 10.' },
      ]
    };

    // Update error history table with server response
    updateErrorHistory(serverResponse.errorHistory);
  }

  function updateErrorHistory(errorHistory) {
    var errorHistoryBody = document.getElementById('error-history-body');
    // Clear existing rows
    errorHistoryBody.innerHTML = '';

    // Add new rows based on the server response
    errorHistory.forEach(function (error) {
      var row = document.createElement('tr');
      var dateCell = document.createElement('td');
      var messageCell = document.createElement('td');

      dateCell.textContent = error.date;
      messageCell.textContent = error.message;

      row.appendChild(dateCell);
      row.appendChild(messageCell);

      errorHistoryBody.appendChild(row);
    });
  }
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>